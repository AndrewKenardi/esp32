<form id="loginForm">
  <input type="text" id="username" placeholder="Username" required />
  <input type="password" id="password" placeholder="Password" required />
  <button type="submit">Login</button>
</form>

<script type="module">
  import { db } from './firebase.js';
  import { collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

  const loginForm = document.getElementById('loginForm');
  loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;

    try {
      const q = query(
        collection(db, "admins"),
        where("username", "==", username),
        where("password", "==", password)
      );

      const snapshot = await getDocs(q);

      if (!snapshot.empty) {
        // Login sukses
        localStorage.setItem("isLoggedIn", "true");

        const redirect = localStorage.getItem("redirectAfterLogin");
        if (redirect) {
          localStorage.removeItem("redirectAfterLogin");
          window.location.href = redirect;
        } else {
          window.location.href = "index.html";
        }
      } else {
        alert("Username atau password salah.");
      }

    } catch (err) {
      alert("Terjadi kesalahan: " + err.message);
    }
  });
</script>
