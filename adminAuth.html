<form id="loginForm">
  <input type="text" id="username" placeholder="Username" required />
  <input type="password" id="password" placeholder="Password" required />
  <button type="submit">Login</button>
</form>

<script type="module">
  import { db } from './firebase.js';
  import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const loginForm = document.getElementById('loginForm');

  loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const inputUsername = document.getElementById("username").value;
    const inputPassword = document.getElementById("password").value;

    try {
      const querySnapshot = await getDocs(collection(db, "Admin"));

      let success = false;

      querySnapshot.forEach((doc) => {
        const data = doc.data();
        if (data.username === inputUsername && data.password === inputPassword) {
          success = true;
        }
      });

      if (success) {
        const redirect = localStorage.getItem('redirectAfterLogin');
        if (redirect) {
          localStorage.removeItem('redirectAfterLogin');
          window.location.href = redirect;
        } else {
          window.location.href = "index.html";
        }
      } else {
        alert("Username atau password salah");
      }

    } catch (error) {
      console.error("Login error:", error);
      alert("Terjadi kesalahan saat login");
    }
  });
</script>
